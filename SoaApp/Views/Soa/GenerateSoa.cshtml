@model SoaApp.Models.ViewModels.SoaVM
@using SoaApp.Utilities

@{
    ViewData["Title"] = "Statement of Account";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<table id="pttAddress" style="margin: 30px;">
    <thead>
        <tr>
            <td rowspan="4">
                <img src="~/img/ptt.png" alt="" />
            </td>
            <td colspan="14"><b>@Model.Company.Name</b></td>
        </tr> <!-- COMPANY NAME -->
        <tr>
            <td colspan="14">@Model.Company.StreetAddress @Model.Company.CityAddress</td>
        </tr> <!-- COMPANY ADDRESS -->
        <tr>
            <td colspan="14">Tel: @Model.Company.TelNo</td>
        </tr> <!-- COMPANY CONTACT -->
        <tr>
            <td colspan="14">@Model.Company.TinNo</td>
        </tr> <!-- COMPANY TIN -->
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td id="tableBorderLeft" style="border-right:solid; border-top: solid; border-left: solid;" colspan="7" class="text-center"><b>STATEMENT OF ACCOUNT</b></td>
        </tr> <!-- STATEMENT OF ACCOUNT -->
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td style="border-bottom: solid; border-left: solid; border-left: solid;">Date:</td>
            <td style="border-bottom: solid;"></td>
            <td style="border-bottom: solid;"></td>
            <td style="border-bottom: solid;"></td>
            <td style="border-bottom: solid;"></td>
            <td class="text-right" colspan="2" style="border-bottom: solid; border-right: solid;">@DateTime.Now.Date.ToShortDateString()</td>
        </tr> <!-- DATE -->
        <tr>
            <td colspan="2">Customer Name: </td>
            <td colspan="5"><b>@Model.Customer.Name</b></td>
            <td style="border-left: solid;" colspan="2">Previous Balance</td>
            <td></td>
            @if (SD.DollarTotal != 0)
            {
                <td>USD</td>
                <td>0</td>
            }
            else
            {
                <td></td>
                <td></td>
            }
            <td>PHP</td>
            @if (Model.PreviousBalance == 0)
            {
                <td style="border-right: solid">0</td>
            }
            else
            {
                <td style="border-right: solid">@Model.PreviousBalance.ToString("0,0.00")</td>
            }
        </tr> <!-- CUSTOMER NAME -->
        <tr>
            <td colspan="2">Customer Number: </td>
            <td colspan="5">@Model.Customer.Code</td>
            <td style="border-left: solid;" colspan="2">Total Payments</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            @if (Model.TotalPayments < 0)
            {
                var totals = Model.TotalPayments * -1;
                <td style="border-right: solid;">
                    (@totals.ToString("0,0.00"))
                </td>
            }
            else
            {
                <td style="border-right: solid;">
                    @Model.TotalPayments.ToString("0,0.00");
                </td>
            }
        </tr> <!-- CUSTOMER NUMBER -->
        <tr>
            <td colspan="2">Attention to: </td>
            <td colspan="5">@Model.Customer.AttentionTo</td>
            <td style="border-left: solid;" colspan="3">Total Credit and Debit Memo</td>
            <td></td>
            <td></td>
            <td></td>
            @if (@Model.TotalCreditAndDebit == 0)
            {
                <td style="border-right: solid">0</td>
            }
            else
            {
                if (Model.TotalCreditAndDebit < 0)
                {
                    var totalcd = Model.TotalCreditAndDebit * -1;
                    <td style="border-right: solid">(@totalcd.ToString("0,0.00"))</td>
                }
                else
                {
                    <td style="border-right: solid">@Model.TotalCreditAndDebit.ToString("0,0.00")</td>
                }
            }
        </tr> <!-- CUSTOMER ATTENTION TO -->
        <tr>
            <td colspan="2">Address: </td>
            <td colspan="5">@Model.Customer.StreetAddress @Model.Customer.CityAddress</td>
            <td style="border-left: solid;" colspan="2">Current Billings</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            @if (Model.TotalCurrentBillings < 0)
            {
                var totalcurrent = Model.TotalCurrentBillings * -1;
                <td style="border-right: solid">(@totalcurrent.ToString("0,0.00"))</td>
            }
            else
            {
                <td style="border-right: solid">@Model.TotalCurrentBillings.ToString("0,0.00")</td>
            }
        </tr> <!-- CUSTOMER ADDRESS -->
        <tr class="font-weight-bold">
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td style="border-bottom: solid; border-top: solid; border-left: solid;" colspan="3">TOTAL AMOUNT DUE</td>
            @if (SD.DollarTotal != 0)
            {
                <td style="border-bottom: solid; border-top: solid;">USD</td>
                <td style="border-bottom: solid; border-top: solid;">0</td>
                <td style="border-bottom: solid; border-top: solid;">PHP</td>
            }
            else
            {
                <td style="border-bottom: solid; border-top: solid;"></td>
                <td style="border-bottom: solid; border-top: solid;"></td>
                <td style="border-bottom: solid; border-top: solid;"></td>
            }
            @if (@SD.TotalAmountDue == 0)
            {
                <td style="border-bottom: solid; border-top: solid; border-right: solid">0</td>
            }
            else
            {
                <td style="border-bottom: solid;  border-top: solid; border-right: solid">@SD.TotalAmountDue.ToString("0,0.00")</td>
            }
        </tr> <!-- TOTAL AMOUNT DUE -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="14"><b>Account Summary as of @Convert.ToDateTime(Model.Posting_Date).ToLongDateString()</b></td>
        </tr> <!-- ACCOUNT SUMMARY AS OF -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="10">Previous Balance</td>
            @if (SD.DollarTotal != 0)
            {
                <td>USD</td>
                <td>0</td>
                <td>PHP</td>
            }
            else
            {
                <td></td>
                <td></td>
                <td></td>
            }
            @if (Model.PreviousBalance < 0)
            {
                var totalPrevious = Model.PreviousBalance * -1;
                <td>(@totalPrevious.ToString("0,0.00"))</td>
            }
            else
            {
                <td>@Model.PreviousBalance.ToString("0,0.00")</td>
            }
        </tr> <!-- PREVIOUS BALANCE -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="14"><b>Payment Details</b></td>
        </tr> <!-- PAYMENT DETAILS -->
        <tr style="border-bottom: 1px solid;">
            <td class="text-center">Doc Type</td>
            <td colspan="2" class="text-center">Referense #</td>
            <td class="text-center">Date</td>
            <td></td>
            <td colspan="5">Description</td>
            @if (SD.DollarTotal != 0)
            {
                <td></td>
                <td>Amount(USD)</td>
            }
            else
            {
                <td></td>
                <td></td>
            }

            <td></td>
            <td>Amount(PHP)</td>
        </tr> <!-- PAYMENT DETAILS HEADER -->
        @foreach (var payments in Model.PaymentsListItem.Where(x =>
(x.DOC_TYPE == "DX" || x.DOC_TYPE == "DY" || x.DOC_TYPE == "DZ") &&
!(x.SP_GL_IND == "C")
).OrderByDescending(c => c.ENTRY_DATE))
        {
            <tr>
                <td class="text-center">@payments.DOC_TYPE</td>
                <td colspan="2" class="text-center">@payments.DOC_NO</td>
                <td class="text-center">@payments.PSTNG_DATE.ToShortDateString()</td>
                <td></td>
                <td colspan="5">@payments.ITEM_TEXT</td>
                @if (SD.DollarTotal != 0)
                {
                    <td></td>
                    @if (payments.DB_CR_IND == "H")
                    {
                        <td>(@SD.DollarTotal)</td>
                        <!--for dollar-->
                    }
                    else
                    {
                        <td>@SD.DollarTotal</td>
                        <!--for dollar-->
                    }
                }
                else
                {
                    <td></td>
                    <td></td>
                }
                <td></td>
                @if (payments.DB_CR_IND == "H")
                {
                    <td>(@payments.LC_AMOUNT.ToString("0,0.00"))</td>
                }
                else
                {
                    <td>@payments.LC_AMOUNT.ToString("0,0.00")</td>
                }
            </tr>
        }   @*PAYMENT DETAILS ITEM LOOP*@
        <tr style="border-top: 1px solid;">
            <td colspan="10"><b>Total Payment</b></td>
            @if (SD.DollarTotal != 0)
            {
                <td>USD</td>
                <td>0</td>
                <td>PHP</td>
            }
            else
            {
                <td></td>
                <td></td>
                <td></td>
            }
            @if (Model.TotalPayments < 0)
            {
                var total = Model.TotalPayments * -1;
                <td>(@total.ToString("0,0.00"))</td>
            }
            else
            {
                <td>@Model.TotalPayments.ToString("0,0.00")</td>
            }
        </tr> <!-- PAYMENT TOTAL -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="14"><b>Unpaid Transactions</b></td>
        </tr> <!-- UNPAID TRANSACTION -->
        <tr style="border-bottom: 1px solid;">
            <td class="text-center">Doc Type</td>
            <td colspan="2" class="text-center">Referense #</td>
            <td class="text-center">Date</td>
            <td class="text-center">Due Date</td>
            <td colspan="5">Description</td>
            @if (SD.DollarTotal != 0)
            {
                <td></td>
                <td>Amount(USD)</td>
            }
            else
            {
                <td></td>
                <td></td>
            }
            <td></td>
            <td>Amount(PHP)</td>
        </tr> <!-- UNPAID TRANSACTION HEADER -->
        @foreach (var unpaid in Model.UnpaidListItem)
        {
            <tr>
                <td class="text-center">@unpaid.DOC_TYPE</td>
                <td colspan="2" class="text-center">@unpaid.DOC_NO</td>
                <td class="text-center">@unpaid.PSTNG_DATE.ToShortDateString()</td>
                <td class="text-center">@unpaid.ENTRY_DATE.ToShortDateString()</td>
                @*@if (@unpaid.ITEM_TEXT == "" || @unpaid.ITEM_TEXT == null)
                    {
                        <td colspan="5">Fuels</td>
                    }
                    else
                    {*@
                <td colspan="5">@unpaid.ITEM_TEXT</td>
                @*}*@
                @if (SD.DollarTotal != 0)
                {
                    <td></td>
                    <td>0</td>
                }
                else
                {
                    <td></td>
                    <td></td>
                }
                <td></td>
                @if (unpaid.DB_CR_IND == "H")
                {
                    <td>(@unpaid.LC_AMOUNT.ToString("0,0.00"))</td>
                }
                else
                {
                    <td>@unpaid.LC_AMOUNT.ToString("0,0.00")</td>
                }
            </tr>
        }  @*UNPAID TRANSACTION ITEM LOOP*@
        <tr style="border-top: 1px solid;">
            <td colspan="10"><b>Total Unpaid Transactions</b></td>
            @if (SD.DollarTotal != 0)
            {
                <td>USD</td>
                <td>0</td>
                <td>PHP</td>
            }
            else
            {
                <td></td>
                <td></td>
                <td></td>
            }
            <td>@Model.TotalUnpaid.ToString("0,0.00")</td>
        </tr> <!-- UNPAID TRANSACTION TOTAL-->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="14"><b>Credit and Debit Memo</b></td>
        </tr> <!-- CREDIT AND DEBIT MEMO -->
        <tr style="border-bottom: 1px solid;">
            <td class="text-center">Doc Type</td>
            <td colspan="2" class="text-center">Referense #</td>
            <td class="text-center">Date</td>
            <td></td>
            <td colspan="5">Description</td>
            @if (SD.DollarTotal != 0)
            {
                <td></td>
                <td>Amount(USD)</td>
            }
            else
            {
                <td></td>
                <td></td>
            }
            <td></td>
            <td>Amount(PHP)</td>
        </tr> <!-- CREDIT AND DEBIT MEMO HEADER -->
        @foreach (var cmDm in Model.CreditAndDebitList)
        {
            <tr>
                <td class="text-center">@cmDm.DOC_TYPE</td>
                <td colspan="2" class="text-center">@cmDm.DOC_NO</td>
                <td class="text-center">@cmDm.PSTNG_DATE.ToShortDateString()</td>
                <td></td>
                <td colspan="5">@cmDm.ITEM_TEXT</td>
                @if (SD.DollarTotal != 0)
                {
                    <td></td>
                    <td>0</td>
                }
                else
                {
                    <td></td>
                    <td></td>
                }
                <td></td>
                @if ((cmDm.DOC_TYPE == "P8" ||
                   cmDm.DOC_TYPE == "DG" ||
                   cmDm.DOC_TYPE == "DJ" ||
                   cmDm.DOC_TYPE == "DH" ||
                   cmDm.DOC_TYPE == "DM") &&
                   cmDm.DB_CR_IND == "H")
                {
                    <td>(@cmDm.LC_AMOUNT.ToString("0,0.00"))</td>
                }
                else
                {
                    <td>@cmDm.LC_AMOUNT.ToString("0,0.00")</td>
                }
            </tr>
        }  <!--CREDIT AND DEBIT MEMO ITEM LOOP-->
        <tr style="border-top: 1px solid;">
            <td colspan="10"><b>Total Credit and Debit Memo</b></td>
            @if (SD.DollarTotal != 0)
            {
                <td>USD</td>
                <td>0</td>
                <td>PHP</td>
            }
            else
            {
                <td></td>
                <td></td>
                <td></td>
            }
            @if (Model.TotalCreditAndDebit < 0)
            {
                var totalcd = Model.TotalCreditAndDebit * -1;
                <td>(@totalcd.ToString("0,0.00"))</td>
            }
            else
            {
                <td>@Model.TotalCreditAndDebit.ToString("0,0.00")</td>
            }
        </tr> <!-- CREDIT AND DEBIT MEMO TOTAL -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="14"><b>Withholding Tax</b></td>
        </tr> <!-- WITHHOLDING TAX -->
        <tr style="border-bottom: 1px solid;">
            <td class="text-center">Doc Type</td>
            <td colspan="2" class="text-center">Referense #</td>
            <td class="text-center">Date</td>
            <td class="text-center">Due Date</td>
            <td colspan="5">Description</td>
            @if (SD.DollarTotal != 0)
            {
                <td></td>
                <td>Amount(USD)</td>
            }
            else
            {
                <td></td>
                <td></td>
            }
            <td></td>
            <td>Amount(PHP)</td>
        </tr> <!-- WITHHOLDING TAX HEADER -->
        @foreach (var cwt in Model.UncollectedCwtList)
        {
            <tr>
                <td class="text-center">@cwt.DOC_TYPE</td>
                <td colspan="2" class="text-center">@cwt.DOC_NO</td>
                <td class="text-center">@cwt.PSTNG_DATE.ToShortDateString()</td>
                <td class="text-center">@cwt.ENTRY_DATE.ToShortDateString()</td>
                <td colspan="5">@cwt.ITEM_TEXT</td>
                @if (Model.TotalUncollectedCwtUsd != 0)
                {
                    <td></td>
                    @if (cwt.DB_CR_IND == "H")
                    {
                        <td>(@cwt.LC_AMOUNT.ToString("0,0.00"))</td>
                    }
                    else
                    {
                        <td>@cwt.LC_AMOUNT.ToString("0,0.00")</td>
                    }
                }
                else
                {
                    <td></td>
                    <td></td>
                }
                <td></td>
                @if (cwt.DB_CR_IND == "H")
                {
                    <td>(@cwt.LC_AMOUNT.ToString("0,0.00"))</td>
                }
                else
                {
                    <td>@cwt.LC_AMOUNT.ToString("0,0.00")</td>
                }
            </tr>
        } <!-- WITHHOLDING TAX ITEM LOOP -->
        <tr style="border-top: 1px solid;">
            <td colspan="10"><b>Total Withholding Tax</b></td>
            @if (Model.TotalUncollectedCwtUsd != 0)
            {
                <td>USD</td>
                <td>0</td>
                @if (Model.TotalUncollectedCwtUsd < 0)
                {
                    var cwttotalUsd = Model.TotalUncollectedCwtUsd * -1;
                    <td>(@cwttotalUsd.ToString("0,0.00"))</td>
                }
                <td>PHP</td>
            }
            else
            {
                <td></td>
                <td></td>
                <td></td>
            }
            @if (Model.TotalUncollectedCwtPhp < 0)
            {
                var cwttotalPhp = Model.TotalUncollectedCwtPhp * -1;
                <td>(@cwttotalPhp.ToString("0,0.00"))</td>
            }
            else
            {
                <td>@Model.TotalUncollectedCwtPhp.ToString("0,0.00")</td>
            }
        </tr> <!-- WITHHOLDING TAX TOTAL -->
        <tr>
            <td colspan="14">&nbsp;</td>
        </tr> <!-- SPACER -->
        <tr>
            <td colspan="10" style="border-bottom: solid; border-top: solid; border-left: solid;"><b>TOTAL AMOUNT DUE</b></td>
            @if (SD.DollarTotal != 0)
            {
                <td style="border-bottom: solid; border-top: solid;"><b>USD</b></td>
                <td style="border-bottom: solid; border-top: solid;"><b>0</b></td>
                <td style="border-bottom: solid; border-top: solid;"><b>PHP</b></td>
            }
            else
            {
                <td style="border-bottom: solid; border-top: solid;"><b></b></td>
                <td style="border-bottom: solid; border-top: solid;"><b></b></td>
                <td style="border-bottom: solid; border-top: solid;"><b></b></td>
            }
            @if (@SD.TotalAmountDue == 0)
            {
                <td style="border-bottom: solid; border-top: solid; border-right: solid;"><b>0</b></td>
            }
            else
            {
                <td style="border-bottom: solid; border-top: solid; border-right: solid;"><b>@SD.TotalAmountDue.ToString("0,0.00")</b></td>
            }
        </tr> <!-- TOTAL AMOUNT DUE -->
    </thead>
</table>
<!-- End of Payment Details -->
<!-- Start of Footer -->
<table>
    <tr>
        <td>
            Please examine your Statement of Account immediately. If there is no discrepancy reported within 7 days, this will be considered correct.
        </td>
    </tr>
</table>
<!-- End of Footer -->
<!-- Start of Legends Part -->
<table>
    <tr>
        <td>Legend:</td>
    </tr>
    <tr>
        <td></td>
        <td><b>P1</b> Invoice</td>
        <td><b>DH</b> Debit Memo - VAT</td>
        <td><b>DX</b> Cust Payment - Lubes</td>
    </tr>
    <tr>
        <td></td>
        <td><b>P8</b> Credit Memo - VAT</td>
        <td><b>DM</b> Debit Memo - Non VAT</td>
        <td><b>DY</b> Cust Payment - Others</td>
    </tr>
    <tr>
        <td></td>
        <td><b>DR</b> Invoice - VAT</td>
        <td><b>SA</b> G/L Account Document</td>
        <td><b>DZ</b> Cust Payment - Fuel</td>
    </tr>
    <tr>
        <td></td>
        <td><b>DI</b> Invoice-Non VAT</td>
        <td><b>AB</b> Gen. Journal Entries</td>
    </tr>
    <tr>
        <td></td>
        <td><b>DG</b> Credit Memo - VAT</td>
        <td><b>ZZ</b> Data Migration</td>
    </tr>
    <tr>
        <td></td>
        <td><b>DJ</b> Credit Memo - Non VAT</td>
    </tr>
</table>
<!-- End of Legends Part -->

<br />
<!-- Start of Footer Part -->
<table>
    <tr>
        <td>Any unpaid charges after due date shall bear an interest rate of 3% and an additional penalty of 3% monthly. All returned checks will be charged a penalty feeof PhP 1,500</td>
    </tr>
</table>
<!-- End of Footer Part -->